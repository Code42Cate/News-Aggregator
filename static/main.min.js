function addLabelEventListener(e){const t=document.getElementById("modal-labels-set");t.innerHTML="<p>Existing labels: </p>";const n=e.target.parentElement.parentElement.children[0].children;for(let e of n)t.innerHTML+=`${e.outerHTML} `}function addNewLabel(){const e=document.getElementById("newLabelInput").value,t=e.replace(" ","").toLowerCase(),n=document.getElementById("labelselect"),a=colourArray[colourIndex];colourIndex+=1,colourIndex==colourArray.length&&(colourIndex=0);const l=`<span class="badge ${t}" id="${t}-label" draggable="true" ondragstart="drag(event)" style="background-color: ${palette.get(a,"700")};color:${palette.getText(a,"500","Secondary")}">${e}</span>`;n.innerHTML+=l,document.getElementById("newLabelInput").value="",document.getElementById("cancelButton").click()}async function updateKeyword(e,t){fetch(`http://localhost:5000/api/v1/categories/${e}`,{body:JSON.stringify({category:t}),method:"PATCH",headers:{"Content-Type":"application/json"}}).then(e=>{console.log(e)})}function allowDrop(e){e.preventDefault()}function drag(e){e.dataTransfer.setData("text/html",e.target.id)}function drop(e){e.preventDefault();var t=e.dataTransfer.getData("text/html"),n=document.getElementById(t).cloneNode(!0);n.removeAttribute("id"),n.removeAttribute("draggable"),n.removeEventListener("dragstart",drag);const a=e.target.innerText,l=n.innerText;e.target.parentNode.replaceChild(n,e.target),updateKeyword(a,l)}function showKeywords(e){const t=e.path[2].cells[1].children[0].dataset.collapsed;if("true"===t){e.path[2].cells[1].children[0].dataset.collapsed=!1;const t=e.path[2].cells[1].children[0].dataset.id;articles.forEach(n=>{let a="";n.id===t&&(n.keywords.forEach(e=>{a+=`<div class="inline keyword" ondrop="drop(event)" ondragover="allowDrop(event)" ondblclick="removeKeyword(event)">${e}</div>`}),e.target.parentElement.innerHTML+=a)})}else{e.path[2].cells[1].children[0].dataset.collapsed=!0;let t=[];for(let n of e.target.parentElement.children)n.classList.contains("keyword")&&t.push(n);for(let e of t)e.remove()}}function removeKeyword(e){const t=e.target.innerText,n=e.path[2].cells[1].children[0].dataset.id;fetch(`http://localhost:5000/api/v1/article/${n}`,{body:JSON.stringify({keyword:t}),method:"PATCH",headers:{"Content-Type":"application/json"}}),e.target.remove()}function loadArticles(e){index+e>0&&(document.getElementById("articletable").innerHTML="",document.getElementById("labelselect").innerHTML='<span class="badge all" id="all-label" draggable="true" ondragstart="drag(event)">All</span>',index+=e,load())}document.getElementById("addlabel").addEventListener("click",addLabelEventListener);const firstLetterToUpperCase=e=>e[0].toUpperCase()+e.substring(1),colourArray=["Red","Pink","Purple","Deep Purple","Indigo","Blue","Light Blue","Cyan","Teal","Green","Light Green","Lime","Yellow","Amber","Orange","Deep Orange","Brown","Grey","Blue Grey","Black","White"];let articles,colourIndex=0,index=20;const load=async()=>{const e=`http://localhost:5000/api/v1/articles/${index}`;let t=[];const n=async()=>{articles=await(await fetch(e)).json();const n={};let a=0;articles.forEach(e=>{e.categories.forEach(e=>{void 0===n[e]&&(n[e]=colourArray[a],a+=1,a===colourArray.length&&(a=0))})});const l=document.getElementById("articletable");let r=articles.length;articles.forEach(e=>{const a=l.insertRow(0),o=(a.insertCell(0).innerHTML=r,a.insertCell(1).innerHTML=`<a href="${e.url}" data-id="${e.id}" data-collapsed="true" >${e.title}</a>`,a.insertCell(2));o.className+=(o.className?" ":"")+"keywords";let c="";e.categories.forEach(e=>{t.push(e);const a=n[e];c+=`<span class="badge" style="background-color: ${palette.get(a,"700")};color:${palette.getText(a,"500","Secondary")};font-size:87%;">${firstLetterToUpperCase(e)}</span>`}),e.categories.length<1?e.keywords.forEach(e=>{c+=`<div class="inline keyword" ondrop="drop(event)" ondragover="allowDrop(event)" ondblclick="removeKeyword(event)">${e}</div>`}):e.keywords.length>0&&(c+='<span class="badge" style="background-color: #424242;color:#fff;font-size:87%;" onclick="showKeywords(event)";>...</span>'),o.innerHTML=c,r-=1}),t=t.filter((e,n)=>t.indexOf(e)===n);const o=document.getElementById("labelselect");t.forEach(e=>{const t=n[e],a=`<span class="badge" id="${e}" style="background-color: ${palette.get(t,"700")}; color:${palette.getText(t,"500","Secondary")}; font-size:87%;" draggable="true" ondragstart="drag(event)">${firstLetterToUpperCase(e)}</span>`;o.innerHTML+=a}),document.getElementById("pagination").style.visibility="visible"};n()};load();